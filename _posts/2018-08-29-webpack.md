---
layout: post
title: '[webpack] webpack4 설정하기'
date: 2018-08-29
author: Uzihoon
comments: true
subtitle: webpack4 사용하는 방법
categories: webpack
cover: '/assets/img/webpack.png'
tags: webpack
---

webpack 설정하기
===========

*이 글은 webpack4 기준으로 설정합니다*

webpack은 뭐고 왜 사용하는 걸까?
-----------

![Alt text](/assets/img/webpack.png)

현재 웹 개발에서 프론트개발과 백개발이 분리가 되어 이루어 지며 javascript 파일도 덩치가 점점 거대해져 하나의 파일로 관리하는데 한계에 도달했다. 그 외에 수많은 문제점들로 인해 javascript 및 css, html 등을 손쉽게 관리하기 위한 툴들이 등장 하기 시작했는데 현재는 webpack이 가장 강력한 모듈 번들러 인것 같다.

웹팩이 보완해주는 부분들은 아래와 같다.

1. javascript에서 모듈 시스템을 활용할 수 있게 해 준다.
2. 각 파일을 번들해주어 독립성을 유지시켜 줄 수 있다.(javascript, css는 물론 html 까지도!)
3. scss, es6 등 babel이나 css-loader등을 통해 크로스 브라우징을 대응해 줄 수 있다.

이 외에도 많은 장점 들이 있으며(webpack-dev-server 라던지..) 웹팩을 사용할 경우 프론트 개발을 이전보다 관리하기 쉬우며 개발이 빠르게 이루어 질 수 있도록 개발 환경을 갖출수 있다.

그러나 웹팩을 정말 제대로 활용하기 위해선 셋팅이 필요한데, 이부분이 처음 시작하시는 분들에게 사용을 꺼리게 만드는 요소가 아닌가 싶다.

웹팩의 개념은 아래와 같다

>Entry, Output, Loaders, Plugins, Mode

Mode는 webpack4에서 추가된 개념으로 배표용(production)과 개발용(development)으로 설정할 수 있으며, webpack은 `import()` 와 `require.ensure()`을 위한 `Promise`가 필요하므로 ES5를 지원하지 않는 브라우저 대응을 위해서는 [pollyfill](https://webpack.js.org/guides/shimming/)이 필요하다.

wepback을 세팅하려면 `node`와 `npm` 또는 `yarn`등의 개념이 필요하다.

```bash
mkdir webpack-test
cd webpack-test
npm init -y
```

폴더와 __package.json__ 을 설정하고 나면 webpack을 설치한다.

```bash
npm i -D webpack webpack-cli
```

__package.json__
```json
{
  "name": "webpack-test",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "webpack": "^4.17.1",
    "webpack-cli": "^3.1.0"
  }
}
```

webpack을 설치하고 나면 __package.json__ 이 있는 루트에 __webpack.config.js__ 파일을 생성해 준다. webpack이 __webpack.config.js__ 파일을 자동으로 불러오기 때문에 이름이 아닐 경우 따로 설정을 해 줘야 한다.

예를 들어 개발용과 배포용 webpack 설정 파일을 따로 생성하고 싶은 경우 __webpack.config.prod.js__ 와 __webpack.config.dev.js__ 파일을 따로 만든 후, __package.json__ 파일에서 따로 설정을 해 줘야 한다.

__package.json__
```json
"scripts": {
    dev: 'webpack --config webpack.config.dev.js',
    build: 'webpack --config webpack.config.prod.js'
}
```

하나의 파일로 따로 빌드할 경우 아래와 같이 할수있다.

__package.json__
```json
"scripts": {
    dev: 'webpack --mode development',
    build: 'webpack --mode production'
},
```

* * *

Entry
-----

`Entry`는 webpack 에서 build 파일의 시작점으로 하나의 파일로 묶어주기 위한 파일이다.

__webpack.config.js__
```javascript
module.exports = {
    entry: {
        index: './src/index.js', //파일 경로
    }
}
```

위와 같이 설정 할 경우, src 폴더에 있는 index.js 기준으로 웹팩이 하나의 파일로 설정을 해준다.

2개 이상의 파일을 `Entry`파일로 설정 하고 싶은 경우 아래와 같이 하면 된다.

__webpack.config.js__
```javascript
module.exports = {
    entry: {
        index: ['./src/main.js', './src/common.js'],
        app: './src/app.js'
    }
}
```

main.js 파일과 common.js 파일을 index.js라고 하나로 묶어 줬다.

`Entry`는 [이곳](https://webpack.js.org/concepts/entry-points/)에서 좀 더 자세히 확인할 수 있다.

* * *

Output
-----

`Output`은 번들된 파일이 어디로 저장될지 설정해주는 부분이다.

__webpack.config.js__
```javascript
module.exports = {
    entry: {
        index: './src/index.js', //파일 경로
    },
    output: {
        filename: 'bundle.js'
    }
}
```

위와 같이 설정하면 ./src/index.js 파일이 bundle.js 파일로 번들되어 저장된다.

하나 이상의 파일을 개별로 번들하고 싶은 경우 아래와 같이 설정한다.

__webpack.config.js__
```javascript
module.exports = {
    entry: {
        index: ['./src/main.js', './src/common.js'],
        app: './src/app.js'
    },
    output: {
        filename: '[name].js',
        path: __dirname + '/dist'
    }
}
```

`path`를 위와 같이 `__dirname+'/dist'`라고 설정할 경우 프로젝트 폴더 루트에 dist 폴더 생성 후 index.js, app.js로 각각 저장된다.

또는 `publicPath`를 설정하여 서버상의 경로로 지정해 줄수도 있다.

__webpack.config.js__
```javascript
module.exports = {
    entry: {
        index: ['./src/main.js', './src/common.js'],
        app: './src/app.js'
    },
    output: {
        filename: '[name].js',
        path: '/dist',
        publicPath: '/',
    }
}
```

`filename`을 `[name]`이라고 설정할 경우 `entry`에서 설정한 key 값으로 저장되며 아래와 같은 방법도 있다.

__webpack.config.js__
```javascript
module.exports = {
    (...)
    //chunk id 설정
    output: {
        filename: '[id].js',
    }
    
    //hash 설정: index.6ee146b7f3bd8baa29c3.js로 저장된다.
    output: {
        filename: '[name].[hash].js',
    }

    //chunkhash 설정: 0a70ffcc9761afee997b.bundle.js 기존 파일이 변경되면 랜덤값이 달라진다.
    output: {
        filename: '[chunkhash].bundle.js',
    }
} 
```

`[hash]`는 랜덤한 문자열을 붙여서 저장이 된다. 개발환경에서 확인을 하거나, 기존에 저장된 캐시 파일을 삭제후 적용하고 싶을 경우 유용하다.
`[chunkhash]`는 파일이 변경될 경우에만 랜덤값을 생성하여 저장해준다.

`[hash]`와 `[chunkhash]`값이 바뀔때마다 html에서 변경해주기는 번거로우므로 개별설정을 따로 해주어야한다.


더 자세한 내용은 [이곳](https://webpack.js.org/configuration/output/#output-filename)에서 확인 할수있다.

* * *

Loaders
-----

`entry`와 `output`을 설정하고 나면 이제 모듈들의 내용을 어떤식으로 번들할지 설정을 해주어야 한다.

쉽게 말해서 transform 을 설정해주는 부분이다.
TypeScript 나 react에서 사용하는 jsx 파일등을 javascript로 해석해서 저장을 해 주며 css, scss등을 javascript 에서 import해서 사용할 수 있게 만들어주는 것도 loader에서 설정을 할 수 있다.
또한 __babel__ 을 이용하여 ES6이상의 문법을 사용하면서 크로스브라우징을 할수도있다.

먼저 js 파일을 babel을 통해 해석할수 있도록 설정해주는 부분이다.

```bash
npm i -D @babel/core babel-loader @babel/preset-env
```

__webpack.config.js__
```javascript
module.exports = {
    entry: {
        app: './src/app.js'
    },
    output: {
        filename: '[name].js',
        path: __dirname + '/dist'
    },
    module: {
        rules: [
            {
            test: /\.js?$/,
            use: {
                loader: 'babel-loader',
            },
            exclude: /node_modules/,
            },
        ]
    }
}
```

`output` 밑에 `module`을 추가 하였다. `rules` 배열 안에 설정을 해주면 되는데,
`test`는 정규식을 통해 `js`파일을 설정하고, `use`에 `loader`로 `babel-loader`를 사용하겠다고 설정을 하면 된다.

`exclude`부분은 `/node_modules/`에 있는 `js`파일은 제외하겠다라고 설정된 부분이다.

